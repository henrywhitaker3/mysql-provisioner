version: '3'

tasks:
  deploy:
    vars:
      IMG: '{{ .IMG | default "henrywhitaker3/mysql-provisioner" }}'
      TAG: '{{ .TAG | default "latest" }}'
    cmds:
    - make docker-build IMG={{ .IMG }}:{{ .TAG }}
    - kind load docker-image {{ .IMG }}:{{ .TAG }}
    - make deploy IMG={{ .IMG }}:{{ .TAG }}

  undeploy:
    - make undeploy

  apply:
    cmds:
      - kubectl apply -f config/samples/mysql-provisioner_v1beta1_connection.yaml
      - kubectl apply -f config/samples/mysql-provisioner_v1beta1_database.yaml
      - kubectl apply -f config/samples/mysql-provisioner_v1beta1_user.yaml

  delete:
    cmds:
      - kubectl delete -f config/samples/mysql-provisioner_v1beta1_database.yaml
      - kubectl delete -f config/samples/mysql-provisioner_v1beta1_user.yaml
      - kubectl delete -f config/samples/mysql-provisioner_v1beta1_connection.yaml

  generate:chart:
    cmds:
      - make helm
